---
layout: post
title: 	Linux操作系统文件系统基础知识详解
category: 技术
tags: Linux
keywords: linux、文件系统
description:
---
本文转载自：[http://linux.chinaunix.net/techdoc/beginner/2007/03/30/953684.shtml](http://linux.chinaunix.net/techdoc/beginner/2007/03/30/953684.shtml)    

### 一 、Linux文件结构     

	　　文件结构是文件存放在磁盘等存贮设备上的组织方法。主要体现在对文件和目录的组织上。
	　　目录提供了管理文件的一个方便而有效的途径。
	　　Linux使用标准的目录结构，在安装的时候，安装程序就已经为用户创建了文件系统和完整而固定的目录组成形式，并指定了每个目录的作用和其中的文件类型。
	　　                    /根目录
	                              ┃
	┏━━┳━━━┳━━━┳━━━╋━━━┳━━━┳━━━┳━━━┓
	┃   ┃      ┃     ┃     ┃     ┃      ┃     ┃     ┃
	bin  home    dev     etc     lib     sbin    tmp      usr    var
	                      ┃                               ┃
	                  ┏━┻━┓     ┏━━┳━━┳━━┳━┻━┳━━┓
	                  ┃      ┃    ┃   ┃    ┃    ┃     ┃    ┃
	                 rc.d   cron.d X11R6  src   lib   local    man  bin
	                  ┃                              
	┏━━━┳━━┳━┻━┳━━━┓        
	┃      ┃    ┃      ┃      ┃
	init.d rc0.d  rc1.d  rc2.d …… linux bin lib src
	　　Linux采用的是树型结构。最上层是根目录，其他的所有目录都是从根目录出发而生成的。微软的DOS和windows也是采用树型结构，但是在DOS和 windows中这样的树型结构的根是磁盘分区的盘符，有几个分区就有几个树型结构，他们之间的关系是并列的。但是在linux中，无论操作系统管理几个磁盘分区，这样的目录树只有一个。从结构上讲，各个磁盘分区上的树型目录不一定是并列的。
	　　如果这样讲不好理解的话，我来举个例子：
	　　有一块硬盘，分成了4个分区，分别是/；/boot；/usr和windows下的fat
	　　对于/和/boot或者/和/usr，它们是从属关系；对于/boot和/usr，它们是并列关系。
	　　如果我把windows下的fat分区挂载到/mnt/winc下，（挂载？？哦，别急，呵呵，一会就讲，一会就讲。）那么对于/mnt/winc和/usr或/mnt/winc和/boot来说，它们是从属于目录树上没有任何关系的两个分支。
	　　因为linux是一个多用户系统，制定一个固定的目录规划有助于对系统文件和不同的用户文件进行统一管理。但就是这一点让很多从windows转到linux的初学者感到头疼。下面列出了linux下一些主要目录的功用。
	　　/bin 二进制可执行命令
	　　/dev 设备特殊文件
	　　/etc 系统管理和配置文件
	　　/etc/rc.d 启动的配置文件和脚本
	　　/home 用户主目录的基点，比如用户user的主目录就是/home/user，可以用~user表示
	　　/lib 标准程序设计库，又叫动态链接共享库，作用类似windows里的.dll文件
	　　/sbin 系统管理命令，这里存放的是系统管理员使用的管理程序
	　　/tmp 公用的临时文件存储点
	　　/root 系统管理员的主目录（呵呵，特权阶级）
	　　/mnt 系统提供这个目录是让用户临时挂载其他的文件系统。
	　　/lost+found 这个目录平时是空的，系统非正常关机而留下“无家可归”的文件（windows下叫什么.chk）就在这里
	　　/proc 虚拟的目录，是系统内存的映射。可直接访问这个目录来获取系统信　　息。
	　　/var 某些大文件的溢出区，比方说各种服务的日志文件
	　　/usr 最庞大的目录，要用到的应用程序和文件几乎都在这个目录。其中包　　含：
	　　/usr/X11R6 存放X window的目录
	　　/usr/bin 众多的应用程序
	　　/usr/sbin 超级用户的一些管理程序
	　　/usr/doc linux文档
	　　/usr/include linux下开发和编译应用程序所需要的头文件
	　　/usr/lib 常用的动态链接库和软件包的配置文件
	　　/usr/man 帮助文档
	　　/usr/src 源代码，linux内核的源代码就放在/usr/src/linux里
	　　/usr/local/bin 本地增加的命令
	　　/usr/local/lib 本地增加的库

### 二 、linux文件系统

	　　文件系统指文件存在的物理空间，linux系统中每个分区都是一个文件系统，都有自己的目录层次结构。linux会将这些分属不同分区的、单独的文件系统按一定的方式形成一个系统的总的目录层次结构。一个操作系统的运行离不开对文件的操作，因此必然要拥有并维护自己的文件系统。
	　　Llinux文件系统使用索引节点来记录文件信息，作用像windows的文件分配表。
	　　索引节点是一个结构，它包含了一个文件的长度、创建及修改时间、权限、所属关系、磁盘中的位置等信息。一个文件系统维护了一个索引节点的数组，每个文件或目录都与索引节点数组中的唯一一个元素对应。系统给每个索引节点分配了一个号码，也就是该节点在数组中的索引号，称为索引节点号。
	linux文件系统将文件索引节点号和文件名同时保存在目录中。所以，目录只是将文件的名称和它的索引节点号结合在一起的一张表，目录中每一对文件名称和索引节点号称为一个连接。
	　　对于一个文件来说有唯一的索引节点号与之对应，对于一个索引节点号，却可以有多个文件名与之对应。因此，在磁盘上的同一个文件可以通过不同的路径去访问它。
	　　可以用ln命令对一个已经存在的文件再建立一个新的连接，而不复制文件的内容。连接有软连接和硬连接之分，软连接又叫符号连接。它们各自的特点是：
	　　硬连接：原文件名和连接文件名都指向相同的物理地址。
	目录不能有硬连接；硬连接不能跨越文件系统（不能跨越不同的分区）
	文件在磁盘中只有一个拷贝，节省硬盘空间；
	　　由于删除文件要在同一个索引节点属于唯一的连接时才能成功，因此可以防止不必要的误删除。
	　　符号连接：用ln -s命令建立文件的符号连接符号连接是linux特殊文件的一种，作为一个文件，它的数据是它所连接的文件的路径名。类似windows下的快捷方式。
	　　可以删除原有的文件而保存连接文件，没有防止误删除功能。
	　　这一段的的内容过于抽象，又是节点又是数组的，我已经尽量通俗再通俗了，又不好加例子作演示。大家如果还是云里雾里的话，我也没有什么办法了，只有先记住，日后在实际应用中慢慢体会、理解了。这也是我学习的一个方法吧。

### 三 、挂载文件系统

	　　由上一节知道，linux系统中每个分区都是一个文件系统，都有自己的目录层次结构。linux会将这些分属不同分区的、单独的文件系统按一定的方式形成一个系统的总的目录层次结构。这里所说的“按一定方式”就是指的挂载。
	将一个文件系统的顶层目录挂到另一个文件系统的子目录上，使它们成为一个整体，称为挂载。把该子目录称为挂载点。
	举个例子吧：
	　　根分区：
	　　/根目录
	┃
	┏━━━━┳━━━━━┳━━━━━┳━━━━━╋━━━━━┳━━━━━┳━━━━━┳━━━━━┓
	┃ ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┃
	bin home dev etc lib sbin tmp usr var
	┃
	┏━┻━┓
	┃ ┃
	rc.d cron.d
	┃
	┏━━━┳━━━┳━┻━┳━━━━┓
	┃ ┃ ┃ ┃ ┃
	init.d rc0.d rc1.d rc2.d ……
	　　/usr分区 ：
	　　usr
	┃
	┏━━━━┳━━━╋━━━┳━━━┳━━━┓
	┃ ┃ ┃ ┃ ┃ ┃
	X11R6 src lib local man bin
	┃ ┃
	┃ ┏━━━╋━━━┓
	┃ ┃ ┃ ┃
	linux bin lib src
	　　挂载之后就形成了文章开始时的那个图。像不像挂上去的？
	　　注意：1、挂载点必须是一个目录。
	　　2、一个分区挂载在一个已存在的目录上，这个目录可以不为空，但挂载后这个目录下以前的内容将不可用。
	对于其他操作系统建立的文件系统的挂载也是这样。但是需要理解的是：光盘、软盘、其他操作系统使用的文件系统的格式与linux使用的文件系统格式是不一样的。光盘是ISO9660；软盘是fat16或ext2；windows NT是fat16、NTFS；windows98是fat16、fat32；windows2000和windowsXP是fat16、fat32、 NTFS。挂载前要了解linux是否支持所要挂载的文件系统格式。
	　　挂载时使用mount命令：
	格式：mount [-参数] [设备名称] [挂载点]
	　　其中常用的参数有
	　　-t 指定设备的文件系统类型，常见的有：
	　　minix linux最早使用的文件系统
	　　ext2 linux目前常用的文件系统
	　　msdos MS-DOS的fat，就是fat16
	　　vfat windows98常用的fat32
	　　nfs 网络文件系统
	　　iso9660 CD-ROM光盘标准文件系统
	　　ntfs windows NT 2000的文件系统
	　　hpfs OS/2文件系统
	　　auto 自动检测文件系统
	　　-o 指定挂载文件系统时的选项。有些也可用在/etc/fstab中。常用的　　有
	　　codepage=XXX 代码页
	　　iocharset=XXX 字符集
	　　ro 以只读方式挂载
	　　rw 以读写方式挂载
	　　nouser 使一般用户无法挂载
	　　user 可以让一般用户挂载设备
	　　提醒一下，mount命令没有建立挂载点的功能，因此你应该确保执行mount命令时，挂载点已经存在。（不懂？说白了点就是你要把文件系统挂载到哪，首先要先建上个目录。这样OK？）
	　　例子：windows98装在hda1分区，同时计算机上还有软盘和光盘需要挂载。
	　　# mk /mnt/winc
	　　# mk /mnt/floppy
	　　# mk /mnt/cdrom
	　　# mount -t vfat /dev/hda1 /mnt/winc
	　　# mount -t msdos /dev/fd0 /mnt/floppy
	　　# mount -t iso9660 /dev/cdrom /mnt/cdrom
	　　现在就可以进入/mnt/winc等目录读写这些文件系统了。
	　　要保证最后两行的命令不出错，要确保软驱和光驱里有盘。（要是硬盘的磁盘片也可以经常随时更换的话，我想就不会犯这样的错误了 :-> ）
	如果你的windows98目录里有中文文件名，使用上面的命令挂载后，显示的是一堆乱码。这就要用到 -o 参数里的codepage iocharset选项。codepage指定文件系统的代码页，简体中文中文代码是936；iocharset指定字符集，简体中文一般用cp936或 gb2312。
	　　当挂载的文件系统linux不支持时，mount一定报错，如windows2000的ntfs文件系统。可以重新编译linux内核以获得对该文件系统的支持。关于重新编译linux内核，就不在这里说了。
	　　四 、自动挂载
	　　每次开机访问windows分区都要运行mount命令显然太烦琐，为什么访问其他的linux分区不用使用mount命令呢？
	　　其实，每次开机时，linux自动将需要挂载的linux分区挂载上了。那么我们是不是可以设定让linux在启动的时候也挂载我们希望挂载的分区，如windows分区，以实现文件系统的自动挂载呢？
	　　这是完全可以的。在/etc目录下有个fstab文件，它里面列出了linux开机时自动挂载的文件系统的列表。我的/etc/fstab文件如下：
	　　/dev/hda2 / ext3 defaults 1 1
	　　/dev/hda1 /boot ext3 defaults 1 2
	　　none /dev/pts devpts gid=5,mode=620 0 0
	　　none /proc proc defaults 0 0
	　　none /dev/shm tmpfs defaults 0 0
	　　/dev/hda3 swap swap defaults 0 0
	　　/dev/cdrom /mnt/cdrom iso9660 noauto,codepage=936,iocharset=gb2312 0 0
	　　/dev/fd0 /mnt/floppy auto noauto,owner,kudzu 0 0
	　　/dev/hdb1 /mnt/winc vfat defaults,codepage=936,iocharset=cp936 0 0
	　　/dev/hda5 /mnt/wind vfat defaults,codepage=936,iocharset=cp936 0 0
	　　在/etc/fstab文件里，第一列是挂载的文件系统的设备名，第二列是挂载点，第三列是挂载的文件系统类型，第四列是挂载的选项，选项间用逗号分隔。第五六列不知道是什么意思，还望高手指点。
	　　在最后两行是我手工添加的windows下的C；D盘，加了codepage=936和iocharset=cp936参数以支持中文文件名。参数defaults实际上包含了一组默认参数：
	　　rw 以可读写模式挂载
	　　suid 开启用户ID和群组ID设置位
	　　dev 可解读文件系统上的字符或区块设备
	　　exec 可执行二进制文件
	　　auto 自动挂载
	　　nouser 使一般用户无法挂载
	　　async 以非同步方式执行文件系统的输入输出操作
	　　大家可以看到在这个列表里，光驱和软驱是不自动挂载的，参数设置为noauto。（如果你非要设成自动挂载，你要确保每次开机时你的光驱和软驱里都要有盘，呵呵。)
